ARG ERLANG_VERSION

FROM eu.gcr.io/cf-rabbitmq-core/erlang_elixir:${ERLANG_VERSION}

RUN apt-get update && apt-get install -y rsync

RUN curl -L -o buildevents https://github.com/honeycombio/buildevents/releases/latest/download/buildevents-linux-amd64
RUN chmod 755 buildevents
RUN mv buildevents /usr/bin/

ENV UNPRIVILEGED_USER=rabbitmq
RUN useradd \
    --create-home \
    --comment 'CI unprivileged user' \
    ${UNPRIVILEGED_USER}

USER ${UNPRIVILEGED_USER}

WORKDIR /workspace

# Copy in the secondary umbrellas fetched in GitHub Actions
COPY . .
